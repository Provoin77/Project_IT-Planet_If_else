{% extends 'base.html' %}

{% block content %}
  <div class="profile-page">

    {% if is_moderator %}
      <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
      <form method="post" class="section profile-section">
        <input type="hidden" name="form_type" value="profile">

        <div class="form-row">
          <label for="full_name">–ò–º—è:</label>
          <input type="text" name="full_name" id="full_name" value="{{ user.full_name or '' }}" required>
        </div>

        <div class="form-row">
          <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
          <input type="text" name="username" id="username" value="{{ user.username }}" required>
        </div>

        <div class="form-row">
          <label for="email">Email:</label>
          <input type="email" name="email" id="email" value="{{ user.email }}" required>
        </div>

        <div class="form-row">
          <label for="telegram_login">Telegram:</label>
          <input type="text" name="telegram_login" id="telegram_login" value="{{ user.telegram_login or '' }}">
        </div>

        <div class="form-row">
          <label for="date_of_birth">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
          <input type="date" name="date_of_birth" id="date_of_birth" value="{{ user.date_of_birth or '' }}">
        </div>

        <div class="form-row">
          <label for="phone_number">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
          <input type="text" name="phone_number" id="phone_number" value="{{ user.phone_number or '' }}">
        </div>

        <div class="form-row">
          <label for="about_me">–û —Å–µ–±–µ:</label>
          <textarea name="about_me" id="about_me" rows="4">{{ user.about_me or '' }}</textarea>
        </div>

        <div class="form-row">
          <label>–ü–æ–ª:</label>
          <div class="gender-group">
            <label class="radio-circle">
              <input type="radio" name="gender" value="male" {% if user.gender=='male' %}checked{% endif %}>
              <span class="circle"></span> –ú—É–∂—Å–∫–æ–π
            </label>
            <label class="radio-circle">
              <input type="radio" name="gender" value="female" {% if user.gender=='female' %}checked{% endif %}>
              <span class="circle"></span> –ñ–µ–Ω—Å–∫–∏–π
            </label>
          </div>
        </div>

        <div class="form-row">
          <label for="skills">–ù–∞–≤—ã–∫–∏:</label>
          <input type="text" name="skills" id="skills" value="{{ user.skills or '' }}">
        </div>

        <div class="form-row button-row">
          <label></label>
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
      </form>

      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <form method="post" class="section profile-section">
        <input type="hidden" name="form_type" value="password">
        <h3>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>

        <div class="form-row">
          <label for="new_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" name="new_password" id="new_password" required>
        </div>

        <div class="form-row">
          <label for="confirm_password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" name="confirm_password" id="confirm_password" required>
        </div>

        <div class="form-row button-row">
          <label></label>
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        </div>
      </form>

    {% else %}
      <h2>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="section profile-section">
        <p><strong>–ò–º—è:</strong> {{ user.full_name }}</p>
        <p><strong>–õ–æ–≥–∏–Ω:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>

        <form method="post" class="event-form">
          <input type="hidden" name="form_type" value="profile">

          <div class="form-row">
            <label for="telegram_login">Telegram:</label>
            <input type="text" name="telegram_login" id="telegram_login"
                   value="{{ user.telegram_login or '' }}">
          </div>

          <div class="form-row">
            <label for="date_of_birth">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
            <input type="date" name="date_of_birth" id="date_of_birth"
                   value="{{ user.date_of_birth }}" {% if user.date_of_birth %}disabled{% endif %}>
          </div>

          <div class="form-row">
            <label for="phone_number">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
            <input type="text" name="phone_number" id="phone_number"
                   value="{{ user.phone_number or '' }}">
          </div>

          <div class="form-row">
            <label for="about_me">–û —Å–µ–±–µ:</label>
            <textarea name="about_me" id="about_me" rows="4">{{ user.about_me or '' }}</textarea>
          </div>

          <div class="form-row">
            <label>–ü–æ–ª:</label>
            <div class="gender-group">
              <label class="radio-circle">
                <input type="radio" name="gender" value="male" {% if user.gender=='male' %}checked{% endif %}>
                <span class="circle"></span> –ú—É–∂—Å–∫–æ–π
              </label>
              <label class="radio-circle">
                <input type="radio" name="gender" value="female" {% if user.gender=='female' %}checked{% endif %}>
                <span class="circle"></span> –ñ–µ–Ω—Å–∫–∏–π
              </label>
            </div>
          </div>

          <div class="form-row">
            <label for="skills">–ù–∞–≤—ã–∫–∏:</label>
            <input type="text" name="skills" id="skills"
                   value="{{ user.skills or '' }}">
          </div>
            <div class="form-row">
                <label for="region">–†–µ–≥–∏–æ–Ω:</label>
                <input type="text"
                       name="region"
                       id="region"
                       value="{{ user.region or '' }}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ú–æ—Å–∫–≤–∞">
            </div>

          <div class="form-row button-row">
            <label></label>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </div>
{# ‚Äî‚Äî‚Äî Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Äî‚Äî‚Äî #}
  {% if not user.email_2fa_enabled %}
    <div class="form-group">
      <label>Telegram:</label>
      {% if user.telegram_login %}
        <span>{{ user.telegram_login }}</span>
      {% else %}
        <a href="{{ url_for('auth_telegram.link_telegram') }}">–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram</a>
      {% endif %}
    </div>
  {% endif %}

  {# ‚Äî‚Äî‚Äî Email-2FA ‚Äî‚Äî‚Äî #}
  {% if not user.telegram_login %}
    <h2>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Email)</h2>
    {% if user.email_2fa_enabled %}
      <form method="post" action="{{ url_for('auth_email.email_2fa_disable') }}">
        <button type="submit">–û—Ç–∫–ª—é—á–∏—Ç—å Email-2FA</button>
      </form>
      <p>üìß Email-2FA –≤–∫–ª—é—á–µ–Ω–∞.</p>
    {% else %}
      <p>üìß Email-2FA –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞.</p>
      <a href="{{ url_for('auth_email.email_2fa_setup') }}" class="btn">–í–∫–ª—é—á–∏—Ç—å Email-2FA</a>
    {% endif %}
  {% endif %}


      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <form method="post" class="section profile-section">
        <input type="hidden" name="form_type" value="password">
        <h3>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>

        <div class="form-row">
          <label for="old_password">–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" name="old_password" id="old_password" required>
        </div>

        <div class="form-row">
          <label for="new_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" name="new_password" id="new_password" required>
        </div>

        <div class="form-row">
          <label for="confirm_password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
          <input type="password" name="confirm_password" id="confirm_password" required>
        </div>

        <div class="form-row button-row">
          <label></label>
          <button type="submit">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        </div>
      </form>

    {% endif %}

  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='notifications.js') }}"></script>
{% endblock %}
